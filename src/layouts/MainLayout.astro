---
import { ClientRouter } from 'astro:transitions';
import { siteConfig } from '../config';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Sidebar from '../components/Sidebar.astro';
import MobileNav from '../components/MobileNav.astro';
import themeScript from '../utils/theme-script.ts?raw';

export interface Props {
  title: string;
  description?: string;
  useContentPane?: boolean;
}

const { title=siteConfig.title, description = siteConfig.description, useContentPane = true } = Astro.props;
---

<!doctype html>
<html lang="zh-CN">
	<head>
		<BaseHead title={title} description={description} />
		<script is:inline set:html={themeScript} />
	</head>
	<body class="bg-page text-primary" style={`
		--primary-hue: ${siteConfig.themeColor.hue};
		--page-width: ${siteConfig.pageWidth}; 
		--sidebar-width: ${siteConfig.sidebarWidth};
	`}>
	
		<ClientRouter />
		<div class="layout-container">
			<Sidebar transition:persist />
            <MobileNav /> 
			<!-- 添加导航切换动画类 -->
			<main class="main-content">
				{useContentPane ? (
					<div class="content-pane">
						<slot />
					</div>
				) : (
					<div class="content-wrapper">
						<slot />
					</div>
				)}
			</main>
		</div>

		<Footer />
		
		<style is:global>
			* {
				box-sizing: border-box;
			}

			.layout-container {
				display: flex;
				min-height: 100vh;
			}
			
			.main-content {
				flex: 1;
				background-color: var(--page-bg);
				min-height: 100vh;
				/* 仅保留 margin-left 过渡，用于侧边栏响应式变化 */
				transition: margin-left 0.3s ease;
				padding: 0 1rem;
			}

			/* 用于首页列表等无面板页面：仅居中和限制宽度 */
			.content-wrapper {
				max-width: var(--page-width);
				width: 100%;
				margin: 0 auto;
				padding: 2rem 1rem;
			}

			/* 用于文章详情页等有面板页面：带背景、阴影、圆角 */
			.content-pane {
				max-width: var(--page-width);
				width: 100%;
				margin: 2rem auto;
				padding: 2rem;
				background-color: var(--content-pane-bg);
				border-radius: 0.75rem;
				box-shadow: 0 1px 3px rgba(0,0,0,0.02), 0 4px 12px rgba(0,0,0,0.08);
			}

			/* 深色模式调整 */
			html.dark .content-pane {
				background-color: var(--content-pane-bg);
				border: 1px solid var(--line-divider);
				box-shadow: none;
			}

			/* 桌面端适配（≥1024px） */
			@media (min-width: 1024px) {
				:global(#sidebar) {
					width: var(--sidebar-width) !important;
				}
				
				.main-content {
					margin-left: var(--sidebar-width);
					padding: 0 2rem;
				}

				.content-wrapper, .content-pane {
					padding: 2rem;
				}
			}
			
			/* 移动端适配（<1024px） */
			@media (max-width: 1023px) {
				.main-content {
					margin-left: 0 !important;
					padding-top: 3.5rem;
				}

				.content-wrapper {
					padding: 1rem;
				}
				
				.content-pane {
					margin: 1rem auto;
					padding: 1.5rem;
					border-radius: 0.5rem;
					max-width: calc(100vw - 2rem);
				}
			}
			</style>
	</body>
</html>
