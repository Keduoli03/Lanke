---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import { Image } from 'astro:assets';
import MainLayout from '../../layouts/MainLayout.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import Footer from '../../components/Footer.astro';

export async function getStaticPaths() {
	const posts = await getCollection('posts');
	
	// 只为单篇文章生成路径
	return posts.map(post => ({
		params: { slug: post.data.slug },
		props: { entry: post }
	}));
}

type Props = {
	entry: CollectionEntry<'posts'>;
};

const { entry } = Astro.props;

const { Content } = await render(entry);
---
<MainLayout title={entry.data.title} description={entry.data.description || entry.data.title}>
  <article class="max-w-4xl mx-auto px-6 py-8">
    {entry.data.cover && (
      <div class="hero-image mb-8">
        <Image 
          width={1020} 
          height={510} 
          src={entry.data.cover} 
          alt={entry.data.title}
          class="w-full h-auto rounded-lg shadow-lg"
        />
      </div>
    )}
    
    <header class="mb-8">
      <h1 class="text-4xl font-bold mb-4">{entry.data.title}</h1>
      <div class="text-gray-600 dark:text-gray-400 mb-4">
        <FormattedDate date={entry.data.date} />
        {entry.data.updated && (
          <span class="ml-4">
            最后更新: <FormattedDate date={entry.data.updated} />
          </span>
        )}
      </div>
      
      <div class="flex flex-wrap gap-2 mb-4">
        {entry.data.categories && entry.data.categories.map(category => (
          <span class="bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full">
            {category}
          </span>
        ))}
        {entry.data.tags && entry.data.tags.map(tag => (
          <span class="bg-gray-100 text-gray-800 text-sm px-3 py-1 rounded-full">
            #{tag}
          </span>
        ))}
      </div>
      
      {entry.data.pinned && (
        <div class="bg-yellow-100 text-yellow-800 text-sm px-3 py-1 rounded-full inline-block mb-4">
          📌 置顶文章
        </div>
      )}
    </header>
    
    <div class="prose prose-lg max-w-none dark:prose-invert">
      <Content />
    </div>
  </article>
  <Footer />
</MainLayout>