---
import Artalk from '@/components/util/Artalk.astro';
import MainLayout from '../layouts/MainLayout.astro';
import { items as friends } from '../page_data/friend';
import Markdown from '@/components/util/Markdown.astro';
import { getEntry } from 'astro:content';
import { render } from 'astro:content';

const title = "友链";
const description = "一些朋友们的网站";
const friendPost = await getEntry("pages", "friend");
// 添加类型检查
if (!friendPost) {
  throw new Error('Friend page not found');
}
const { Content } = await render(friendPost);

---
<MainLayout title={title}>
  <div class="px-4">
    <header class="about-header">
      <h1 class="about-title">{title}</h1>
      <p class="about-subtitle">{description}</p>
    </header>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {friends.map(friend => (
        <a href={friend.siteurl} target="_blank" rel="noopener noreferrer" class="block p-6 bg-[var(--page-bg)] rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300">
          <div class="flex items-center mb-4">
            {friend.imgurl && <img src={friend.imgurl} alt={friend.title} class="w-12 h-12 rounded-full mr-4 object-cover" />}
            <h2 class="text-xl font-semibold">{friend.title}</h2>
          </div>
          <p class="text-[var(--text-secondary)] mb-4">{friend.desc}</p>
          <div class="flex flex-wrap gap-2">
            {friend.tags.map(tag => (
              <span class="px-2 py-1 bg-[var(--tag-bg)] text-sm rounded-md">{tag}</span>
            ))}
          </div>
        </a>
      ))}
    </div>

    <!-- 与Markdown内容保持距离的分隔区块 -->
    <div class="friend-notes-separator"></div>

    <Markdown>
      <Content />
    </Markdown>
    <section class="comments-section" aria-labelledby="comments-title">
      <h2 id="comments-title" class="comments-title">评论</h2>
      <div id="comment-section">
        <Artalk />
      </div>
    </section>
  </div>
  <style>
    .about-header {
      text-align: center;
      margin-bottom: 3rem;
      padding-bottom: 1.5rem;
      border-bottom: 2px solid var(--line-divider);
      width: 100%;
    }
    .about-title {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      font-size: 2.25rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      line-height: 1;
    }
    .about-subtitle {
      color: var(--text-secondary);
      font-size: 1.125rem;
      margin: 0;
    }
    /* 新增：评论区样式 */
    .comments-section {
      margin-top: 2.5rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--line-divider);
    }
    .comments-title {
      text-align: center;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 1rem;
    }
    #comment-section {
      max-width: var(--page-width);
      margin: 0 auto;
    }
    .link-requirements {
      margin-top: 2rem;
      padding-top: 1.25rem;
      border-top: 1px solid var(--line-divider);
    }
    .section-title {
      text-align: center;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.75rem;
    }
    .requirements-code {
      background: var(--content-pane-bg);
      border: 1px solid var(--line-divider);
      border-radius: 0.5rem;
      padding: 0.75rem;
      white-space: pre-wrap;
      line-height: 1.5;
    }
    .requirements-list {
      margin-top: 0.75rem;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }
    .requirements-list .link {
      color: var(--theme-color);
      text-decoration: none;
    }
    .requirements-list .link:hover {
      text-decoration: underline;
    }
    @media (max-width: 1023px) {
      .link-requirements {
        margin-top: 1.5rem;
        padding-top: 1rem;
      }
    }
    @media (max-width: 1023px) {
      .comments-section {
        margin-top: 2rem;
        padding-top: 1rem;
      }
    }
    .friend-notes-separator {
      margin-top: 2rem; /* 与上方网格的距离 */
      padding-top: 1rem; /* 分隔内边距 */
      border-top: 1px solid var(--line-divider); /* 分隔线 */
    }
    @media (max-width: 1023px) {
      .friend-notes-separator {
        margin-top: 1.5rem;
        padding-top: 0.75rem;
      }
    }
  </style>
</MainLayout>