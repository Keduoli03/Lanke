---
import type { Page } from 'astro';

interface Props {
  page: Page<any>;
  baseUrl?: string; 
}

const { page, baseUrl } = Astro.props;

const generatePageNumbers = (current: number, total: number) => {
  if (total <= 7) {
    return Array.from({ length: total }, (_, i) => i + 1);
  }

  const pages = new Set<number | string>();
  pages.add(1);

  const startPage = Math.max(2, current - 1);
  const endPage = Math.min(total - 1, current + 1);

  if (startPage > 2) {
    pages.add(startPage === 3 ? 2 : '...');
  }

  for (let i = startPage; i <= endPage; i++) {
    pages.add(i);
  }

  if (endPage < total - 1) {
    pages.add(endPage === total - 2 ? total - 1 : '...');
  }

  pages.add(total);
  return Array.from(pages);
};

const pageNumbers = generatePageNumbers(page.currentPage, page.lastPage);

// 生成正确的页面URL（适配 trailingSlash: 'always'）
const normalizeBase = (u: string) => (u.endsWith('/') ? u.slice(0, -1) : u);

const generatePageUrl = (pageNum: number) => {
  if (baseUrl) {
    const b = normalizeBase(baseUrl);
    return pageNum === 1 ? `${b}/` : `${b}/${pageNum}/`;
  } else {
    return pageNum === 1 ? '/' : `/${pageNum}/`;
  }
};
---
<div class="flex justify-center items-center mt-12 px-4 sm:px-0">
  <nav class="inline-flex items-center flex-wrap gap-1 sm:gap-2 justify-center">
    {/* 上一页按钮 - 增强对比 */}
    <a 
      href={page.url.prev || '#'} 
      data-astro-prefetch="load"
      class={`px-2.5 py-1.5 text-sm sm:px-4 sm:py-2.5 sm:text-base rounded-md font-bold transition-all duration-200 ${
        page.url.prev 
          ? 'bg-sidebar-icon text-primary border border-sidebar-icon/50 hover:bg-link-bg hover:text-white shadow hover:shadow-lg hover:translate-y-[-1px]' 
          : 'text-secondary/60 cursor-not-allowed'
      }`}
      { ...(!page.url.prev && { tabindex: -1, 'aria-disabled': 'true' }) }
    >
      &larr;
    </a>
    
    {/* 数字页码 - 强化当前页 */}
    {pageNumbers.map((pageNum) => {
      if (pageNum === '...') {
        return (
          <span class="px-2 py-1.5 text-secondary text-xs sm:text-sm">
            ...
          </span>
        );
      }
      
      const isCurrent = pageNum === page.currentPage;
      const pageUrl = generatePageUrl(pageNum as number);
      return (
        <a
          href={pageUrl}
          data-astro-prefetch
          class={`px-2.5 py-1.5 text-xs sm:px-3.5 sm:py-2 sm:text-sm rounded-md font-medium transition-all duration-200 ${
            isCurrent
              ? 'bg-link-bg text-white font-bold shadow-lg transform scale-105 border border-link-bg/30 ring-1 ring-link-bg/20'
              : 'text-primary hover:bg-sidebar-icon hover:shadow'
          }`}
          aria-current={isCurrent ? 'page' : undefined}
        >
          {pageNum}
        </a>
      );
    })}
    
    {/* 下一页按钮 - 增强对比 */}
    <a 
      href={page.url.next || '#'} 
      data-astro-prefetch="load"
      class={`px-2.5 py-1.5 text-sm sm:px-4 sm:py-2.5 sm:text-base rounded-md font-bold transition-all duration-200 ${
        page.url.next 
          ? 'bg-sidebar-icon text-primary border border-sidebar-icon/50 hover:bg-link-bg hover:text-white shadow hover:shadow-lg hover:translate-y-[-1px]' 
          : 'text-secondary/60 cursor-not-allowed'
      }`}
      { ...(!page.url.next && { tabindex: -1, 'aria-disabled': 'true' }) }
    >
      &rarr;
    </a>
  </nav>
</div>