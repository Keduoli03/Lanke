---
import { Icon } from "astro-icon/components";
import { navBarConfig, siteConfig } from "../config";
import type { NavBarLink } from "../types/config";
import { url } from "../utils/url-utils";
import LightDarkSwitch from "./util/LightDarkSwitch.svelte";
import ThemeSwitch from "./util/ThemeSwitch.svelte";

let links: NavBarLink[] = Object.values(navBarConfig.links);

// 样式辅助函数
function getNavLinkClasses() {
  return "group flex flex-col items-center p-1 w-auto nav-link";
}

function getIconContainerClasses() {
  return "icon-container w-8 h-8 rounded-full flex items-center justify-center mb-1 transition-all relative group-hover:border-2 group-hover:border-[var(--primary)] group-hover:scale-110";
}

function getTextClasses() {
  return "text-xs text-center leading-tight text-[var(--text-secondary)]";
}

function getExternalIconClasses() {
  return "text-xs text-[var(--text-secondary)]/70 mt-1";
}
---

<div
  id="sidebar"
  class="relative h-full bg-[var(--sidebar-bg)] w-16 flex-col transition-colors lg:flex hidden"
>
  <!-- 网站Logo -->
  <div class="p-2 border-b border-[var(--line-divider)] flex justify-center">
    <a href={url("/")} class="hover:opacity-80 transition-opacity">
      <img src="/logo.png" alt={siteConfig.title} class="w-6 h-6" />
    </a>
  </div>

  <nav class="flex-1 p-2">
    <ul class="space-y-3">
      {links.map((l) => (
        <li class="flex justify-center">
          <a
            href={l.external ? l.url : url(l.url)}
            target={l.external ? "_blank" : "_self"}
            rel={l.external ? "noopener noreferrer" : ""}
            class={getNavLinkClasses()}
          >
            <div class={getIconContainerClasses()}>
              {l.icon && <Icon name={l.icon} class="icon text-sm" />}
            </div>
            <span class={getTextClasses()}>{l.name}</span>
            {l.external && (
              <Icon
                name="fa6-solid:arrow-up-right-from-square"
                class={getExternalIconClasses()}
              />
            )}
          </a>
        </li>
      ))}
    </ul>
  </nav>

  <!-- 底部区域 -->
  <div class="p-2 border-t border-[var(--line-divider)]">
    <ul class="space-y-2">
      <li class="flex justify-center">
        <LightDarkSwitch client:load>
          <Icon slot="dark-icon" name="material-symbols:dark-mode-outline" class="bottom-bar-icon h-5 w-5 cursor-pointer" />
          <Icon slot="light-icon" name="material-symbols:light-mode-outline" class="bottom-bar-icon h-5 w-5 cursor-pointer" />
        </LightDarkSwitch>
      </li>
      <li class="flex justify-center">
        <ThemeSwitch client:load>
          <Icon slot="palette-icon" name="material-symbols:palette-outline" class="bottom-bar-icon h-5 w-5 cursor-pointer" />
          <Icon slot="reset-icon" name="fa6-solid:arrow-rotate-left" class="text-xs" />
        </ThemeSwitch>
      </li>
    </ul>
  </div>
</div>

<style>
  #sidebar {
    width: var(--sidebar-width);
    position: fixed;
    top: 0;
    left: 0;
    height: 100%;
    z-index: 10;
    box-shadow: 2px 0 10px -5px rgba(0, 0, 0, 0.05);
  }

  html.dark #sidebar {
    box-shadow: 2px 0 12px -5px rgba(0, 0, 0, 0.2);
  }

  .icon-container {
    background-color: var(--sidebar-icon-bg);
  }

  .icon, .bottom-bar-icon {
    color: var(--sidebar-icon-symbol);
  }

  /* 修复导航链接下划线问题 */
  .nav-link {
    text-decoration: none !important; /* 强制移除下划线 */
    color: inherit; /* 继承父元素颜色 */
  }

  .nav-link:hover,
  .nav-link:focus {
    text-decoration: none !important; /* 确保hover/focus状态也无下划线 */
    outline: none; /* 移除焦点轮廓（可选） */
  }

</style>
